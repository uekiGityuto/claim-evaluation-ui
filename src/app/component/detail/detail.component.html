<div class="container">

  <!-- ヘッダエリア -->
  <header class="main-header">
    <button class="list-icon-button" *ngIf="authFlag" mat-icon-button (click)="displayList()">
      <mat-icon inline="true">view_list</mat-icon>
    </button>
    <span>{{ userId }}</span>
  </header>

  <ng-container *ngIf="!isError; else error">

    <!-- 正常 -->

    <!-- サブヘッダエリア -->
    <div class="detail-header card">
      <span class="detail-header-content">事案番号：{{ this.claim?.CLAIMNUMBER }}</span>
      <span class="detail-header-content">被保険者名：{{ this.claim?.INSUREDNAMEKANA }}</span>
      <span class="detail-header-content">契約者名：</span>
      <span class="detail-header-content">{{ this.claim?.CONTRACTORNAMEKANA }}</span>
      <span class="detail-header-content">保険種類：{{ this.claim?.INSURANCEKIND_EXT }}</span>
      <span class="detail-header-content">事故日：{{ this.claim?.LOSSDATE | date : 'yyyy/M/d' }}</span>
      <span class="detail-header-content">更新日：{{ this.claim?.UPDATEDATE | date : 'yyyy/M/d' }}</span>
    </div>

    <!-- 事案カテゴリエリア -->
    <div class="claim-category-card card">
      <div class="claim-category-card-header">
        <div>
          <span>事案カテゴリ：</span>
          <span [ngClass]="categoryClass">{{ claimCategory }}</span>
        </div>
        <div>
          <span>スコアリング日：</span>
          <span>{{ scoringDate | date : 'yyyy/M/d' }}</span>
        </div>
      </div>
      <div class="claim-category">
        <div class="claim-category-chart">
          <canvas #claimCategoryChart width="744px" height="212px"></canvas>
        </div>
        <div class="claim-category-matrix">
          <div class="ncpd-label matrix-label">NC/PD推定モデル</div>
          <div class="special-label matrix-label">特殊事案モデル</div>
          <div [class.now]="scoreDetails && scoreDetails[1].categoryClass.highBgColor" class="ncpd-high matrix-header child-centering">High</div>
          <div [class.now]="scoreDetails && scoreDetails[1].categoryClass.middleBgColor" class="ncpd-middle matrix-header child-centering">Middle</div>
          <div [class.now]="scoreDetails && scoreDetails[1].categoryClass.lowBgColor" class="ncpd-low matrix-header child-centering">Low</div>
          <div [class.now]="scoreDetails && scoreDetails[0].categoryClass.highBgColor" class="special-high matrix-header child-centering">High</div>
          <div class="high-high matrix-category child-centering"><span [ngClass]="categoryMatrix?.highHighColor">{{ categoryMatrix?.highHigh }}</span></div>
          <div class="high-middle matrix-category child-centering"><span class="high-font-color">{{ categoryMatrix?.highMiddle }}</span></div>
          <div class="high-low matrix-category child-centering"><span class="high-font-color">{{ categoryMatrix?.highLow }}</span></div>
          <div [class.now]="scoreDetails && scoreDetails[0].categoryClass.middleBgColor" class="special-middle matrix-header child-centering">Middle</div>
          <div class="middle-high matrix-category child-centering"><span class="middle-font-color">{{ categoryMatrix?.middleHigh }}</span></div>
          <div class="middle-middle matrix-category child-centering"><span class="middle-font-color">{{ categoryMatrix?.middleMiddle }}</span></div>
          <div class="middle-low matrix-category child-centering"><span class="middle-font-color">{{ categoryMatrix?.middleLow }}</span></div>
          <div [class.now]="scoreDetails && scoreDetails[0].categoryClass.lowBgColor" class="special-low matrix-header child-centering">Low</div>
          <div class="low-high matrix-category child-centering"><span class="middle-font-color">{{ categoryMatrix?.lowHigh }}</span></div>
          <div class="low-middle matrix-category child-centering"><span class="low-font-color">{{ categoryMatrix?.lowMiddle }}</span></div>
          <div class="low-low matrix-category child-centering"><span class="low-font-color">{{ categoryMatrix?.lowLow }}</span></div>
        </div>
      </div>
    </div>

    <!-- モデルエリア -->
    <div class="model">
      <ng-container *ngFor="let scoreDetail of scoreDetails; index as i">
        <div class="model-card card">
          <div class="model-card-header">
            <div>
              <span>{{ scoreDetail.MODELTYPE }}</span>
              <button class="help-icon-button" mat-icon-button (click)="displayHelp()">
                <mat-icon inline="true">help</mat-icon>
              </button>
              <span>： </span>
              <span [ngClass]="scoreDetail.categoryClass">{{ scoreDetail.RANK }}</span>
            </div>
            <div>
              <span>スコア：{{ scoreDetail.SCORE }}</span>
            </div>
          </div>
          <div class="model-card-contents">
            <div class="factor">
              <div class="factor-header raize child-centering">
                <p>スコア上昇要因↑</p>
              </div>
              <div class="model-card-box" *ngFor="let reason of raiseLowerReasons[i]?.raiseReason">
                <p class="factor-score">スコア：{{ reason.REASON }}</p>
                <p class="feature-value">{{ reason.FEATURENAME }}</p>
                <p class="feature-value-description">{{ reason.FEATUREDESCRIPTION }}</p>
              </div>
            </div>
            <div class="factor">
              <div class="factor-header lower child-centering">
                <p>スコア減少要因↓</p>
              </div>
              <div class="model-card-box" *ngFor="let reason of raiseLowerReasons[i]?.lowerReason">
                <p class="factor-score">スコア：{{ reason.REASON }}</p>
                <p class="feature-value">{{ reason.FEATURENAME }}</p>
                <p class="feature-value-description">{{ reason.FEATUREDESCRIPTION }}</p>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>

  </ng-container>

  <!-- 照会エラーメッセージ -->
  <ng-template #error>
    <div class="error-message-box">
      <div class="error-message">
        <p class="font-size-xl">受付番号「{{ claimNumber }}」についてのデータ取得が出来ませんでした。</p>
        <p class="font-size-l">担当者にお問い合わせください。</p>
      </div>
    </div>
  </ng-template>

</div>
